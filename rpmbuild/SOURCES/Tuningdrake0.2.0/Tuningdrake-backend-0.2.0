#!/bin/bash
#Comandos comunes a las 3
#variantes de TuningDrake
#El objetivo es facilitar el mantenimiento
#y aprovechar el codigo comun a las
#3 variantes

if [ $# = 0 ] ; then
 echo "$0 no esta diseñado para ejecutarse directamente
por favor utilice alguna de las variantes de TuningDrake" >&2
 return 1;
fi

case $1 in
 #Configuración de Repositorios Oficiales
 "oficial") 
   if [ "$NumMediaAct" -le "2" ]; then
    if [ -z "$Devel" ]; then
     urpmi.addmedia --wget --distrib --mirrorlist \
"http://api.mandriva.com/mirrors/basic.$Version.$DistArch.list"
     NumMediaOld="$NumMediaAct"
     NumMediaAct="`urpmq --list-media|wc -l`"
     if [ "$NumMediaAct" = "$NumMediaOld" ]; then
      #Configurando ftp://distrib-coffee.ipsl.jussieu.fr en caso de no poder configurar los
      #Repositorios desde la lista de servidores
      urpmi.addmedia --wget --distrib \
"ftp://distrib-coffee.ipsl.jussieu.fr/pub/linux/MandrivaLinux/official/$Version/$DistArch" ;
     fi;
    else
     urpmi.addmedia --wget --distrib --mirrorlist \
"http://api.mandriva.com/mirrors/basic.cooker.$DistArch.list"
     NumMediaOld="$NumMediaAct"
     NumMediaAct="`urpmq --list-media|wc -l`"
     if [ "$NumMediaAct" = "$NumMediaOld" ]; then
      #Configurando ftp://distrib-coffee.ipsl.jussieu.fr en caso de no poder configurar los
      #Repositorios desde la lista de servidores
      urpmi.addmedia --wget --distrib \
"ftp://distrib-coffee.ipsl.jussieu.fr/pub/linux/MandrivaLinux/devel/cooker/$DistArch" ;
     fi;
    fi
    NumMediaAct="`urpmq --list-media|wc -l`"
    if [ "$NumMediaAct" = "$NumMediaOld" ]; then 
     return 1;
    fi
   fi ;;

 "plf")
   #Configuración de Repositorios PLF
   if [ -z "`echo $Media|grep -i "plf"`" ]; then
    if [ -z "$Devel" ]; then
     urpmi.addmedia --wget --distrib --mirrorlist \
"http://plf.zarb.org/mirrors/$Version.$DistArch.list"
     NumMediaOld="$NumMediaAct"
     NumMediaAct="`urpmq --list-media|wc -l`"
     if [ "$NumMediaAct" = "$NumMediaOld" ]; then
      #Configurando ftp://distrib-coffee.ipsl.jussieu.fr en caso de no poder configurar los
      #Repositorios desde la lista de medios
      urpmi.addmedia --wget --distrib \
"ftp://distrib-coffee.ipsl.jussieu.fr/pub/linux/plf/mandriva/cfg/$Version/$DistArch" ;
     fi;
    else
     urpmi.addmedia --wget --distrib --mirrorlist \
"http://plf.zarb.org/mirrors/cooker.$DistArch.list"
     NumMediaOld="$NumMediaAct"
     NumMediaAct="`urpmq --list-media|wc -l`"
     if [ "$NumMediaAct" = "$NumMediaOld" ]; then
       #Configurando ftp://distrib-coffee.ipsl.jussieu.fr en caso de no poder configurar los
       #Repositorios desde la lista de medios
       urpmi.addmedia --wget --distrib \
"ftp://distrib-coffee.ipsl.jussieu.fr/pub/linux/plf/mandriva/cfg/cooker/$DistArch" ;
     fi;
    fi
    NumMediaAct="`urpmq --list-media|wc -l`"
    if [ "$NumMediaAct" = "$NumMediaOld" ]; then
     return 1;
    fi
   fi;;

 "mib")
  #Configuración de repositorios MIB
  if [ -z "`echo $Media|grep -i "mib"`" -a -z "$Devel" ]; then
   if [ "$Version" = "2008.0" ]; then
    rpm -ivh --force http://mib.pianetalinux.org/2008.0/noarch/fix-rpm-macros-1.0-1.mib2008.0.noarch.rpm ;
   fi
   urpmi.addmedia --wget --mirrorlist http://plf.zarb.org/mirrors/$Version.$DistArch.list\
 'PLF Free Backports' ../../../$Version/free/backports/binary/$DistArch &&
   urpmi.addmedia --wget --mirrorlist http://plf.zarb.org/mirrors/$Version.$DistArch.list\
 'PLF Non-free Backports' ../../../$Version/non-free/backports/binary/$DistArch
   if [ `expr "$Version" "<" "2009.1"` = 1 ]; then
    urpmi.addmedia --wget MIB_${Arch}_progs http://mib.pianetalinux.org/$Version/$Arch/progs \
  with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB_${Arch}_games http://mib.pianetalinux.org/$Version/$Arch/games \
  with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB_noarch http://mib.pianetalinux.org/$Version/noarch with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB_${Arch}_NonFree http://mib.pianetalinux.org/$Version/$Arch/non-free \
  with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB_${Arch}_PlfFree http://mib.pianetalinux.org/$Version/$Arch/plf-free \
  with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB_${Arch}_PlfNonFree http://mib.pianetalinux.org/$Version/$Arch/plf-nofree \
  with media_info/synthesis.hdlist.cz;
   else
    urpmi.addmedia --wget --update MIB-basic_${Arch2} http://mib.pianetalinux.org/MIB/$Version/${Arch2}/basic/ with media_info/synthesis.hdlist.cz &&
    urpmi.addmedia --wget MIB-experts_${Arch2} http://mib.pianetalinux.org/MIB/$Version/${Arch2}/experts/ with media_info/synthesis.hdlist.cz
    if [ "$?" != "0" ]; then
     exit 1; 
    fi;
   fi   
  fi;;

 "bdk")
  #Configuración de los repositorios de Blogdrake
   urpmi.addmedia --wget Bdk-${DistArch} ftp://ftp.blogdrake.net/mandriva/$Version/free/$DistArch \
  with media_info/synthesis.hdlist.cz&&
   urpmi.addmedia --wget Bdk-noarch ftp://ftp.blogdrake.net/mandriva/$Version/free/noarch \
  with media_info/synthesis.hdlist.cz
   if [ "$?" != "0" ]; then
    return 1;
   fi;;
  
 "mud")
  #Configuración de los repositorios de MUD
  if [ -z "`echo $Media|grep -i "mud"`"  ]; then
   expr $Version \>= 2007.1 && 
   urpmi.addmedia --wget MUD-${DistArch} ftp://ftp.mandrivauser.de/rpm/GPL/$Version/$DistArch/release/ \
  with media_info/synthesis.hdlist.cz
   if [ "$?" != "0" ]; then
    return 1; 
   fi;
  fi;;
  
 "sound")
  #Configuración de Reproductor de Audio
  shift 1
  for i in $@ ; do
   case $i in
    "Amarok")urpmi --wget --auto amarok;;
    "Exaile")urpmi --wget --auto exaile streamripper;;
    "Audacious")urpmi --wget --auto audacious;;
    "Banshee")urpmi --wget --auto banshee;;
    "Rhythmbox") urpmi --wget --auto rhythmbox;;
     "Xmms") urpmi --wget --auto xmms;;
   esac;
  done;;
 
 "video")
  #Configuración de Reproductor de Video
  shift 1
  for i in $@ ; do
   case $i in
    "DragonPlayer")urpmi --wget --auto dragonplayer;;
    "Kaffeine")urpmi --wget --auto kaffeine4;;
    "Totem")urpmi --wget --auto totem-gstreamer;;
    "Vlc")urpmi --wget --auto vlc-plugin-a52 vlc-plugin-aa vlc-plugin-dv vlc-plugin-dvdnav\
 vlc-plugin-flac vlc-plugin-fluidsynth vlc-plugin-ggi vlc-plugin-mod vlc-plugin-ogg\
 vlc-plugin-opengl vlc-plugin-pulse vlc-plugin-schroedinger vlc-plugin-sdl vlc-plugin-speex\
 vlc-plugin-theora vlc-plugin-twolame vlc-plugin-xosd svlc;;
    "Smplayer")urpmi --wget --auto smplayer;;
    "Kmplayer")urpmi --wget --auto kmplayer mplayerplugin;;
   esac;
  done;;

 "genericos")
  #Instalar Aplicación de Configuración de Impresoras
  #En las ediciones One por falta de espacio no viene
  #incluida en el medio.
  if [ `expr "$Version" ">=" "2009.0"` = 1 ]; then
   urpmi --wget --auto system-config-printer;
  fi
  
  #Codecs
  urpmi --wget --auto --allow-suggests gstreamer0.10-decoders
  if [ "$Arch" = "x86_64" ]; then
   CODECS="http://www.mplayerhq.hu/MPlayer/releases/codecs/mplayer-codecs-20061022-1.x86_64.rpm\
 http://www.mplayerhq.hu/MPlayer/releases/codecs/mplayer-codecs-extra-20061022-1.x86_64.rpm\ 
 lib64quicktime";
  else
   CODECS="win32-codecs xanim-codecs libquicktime";
  fi
  urpmi --wget --auto real-codecs $CODECS libquicktime-x264 libquicktime-lame libquicktime-faad\
 libquicktime-faac faad2 xine-faad faac libamrnb3 libamrwb3 amrnb amrwb
  urpmi --wget --auto lame gstreamer0.10-a52dec gstreamer0.10-amrnb gstreamer0.10-amrwb\
 gstreamer0.10-faad gstreamer0.10-faac gstreamer0.10-ffmpeg mencoder gstreamer0.10-lame
  urpmi --wget --auto gstreamer0.10-flac gstreamer0.10-cdio gstreamer0.10-cdparanoia\
 ffmpeg mencoder transcode gstreamer0.10-mms
 
  #Plugins
  JavaVersion="`urpmq --fuzzy java|grep -e "sun"$|sort -rd|cut -d '
' -f 1|cut -d '-' -f 2`"
  urpmi --wget --auto flash-player-plugin mplayerplugin mozilla-plugin-dejavu java-${JavaVersion}-sun
  update-alternatives --set java /usr/lib/jvm/jre-${JavaVersion}-sun/bin/java
  if [ `expr "$Version" ">=" "2009.1"` = 1 ]; then
   urpmi --wget --auto gecko-mediaplayer;
  fi
 
  #Graficos
  urpmi --wget --auto xsane-gimp

  #Manuales y autocompletado
  urpmi --wget --auto man-pages-`locale|grep LANG|cut -d '=' -f 2|cut -d '_' -f 1` bash-completion \
bash-doc coreutils-doc

  #Compatibilidad con particiones win2
  if [ `expr "$Version" ">=" "2008.1"` = 1 ]; then
   urpmi --wget --auto ntfs-config;
  fi
  #Creación del Lanzador para abrir y cerrar la bandeja del
  #lector de discos opticos (Cd/Dvd) desde la comodidad del escritoro
  #Aportación proveniente del usuario inot en http://blogdrake.net/node/12236
  #Pendiente a investigar como crea Mandriva ciertos lanzadores automaticamente
  #para ver si es posible añadir este al proceso
  echo "[Desktop Entry]
 Version=1.0
 Encoding=UTF-8
 Type=Application
 Name=Cargar-Expulsar CD
 Comment=
 Categories=Application;
 Exec=eject -T /dev/cdrom
 Icon=media-eject
 Terminal=false
 StartupNotify=false" > /tmp/"Cargar-Expulsar CD.desktop"
  chmod a+rw /tmp/"Cargar-Expulsar CD.desktop"
  for i in /home/*/Escritorio; do
   cp -fp /tmp/"Cargar-Expulsar CD.desktop" $i/ ;
  done;;

 "im")
  #Mensajeria instantanea
  shift 1
  for i in $@ ; do
   case $i in
    "Amsn")urpmi --wget --auto amsn;;
    "Pidgin")urpmi --wget --auto pidgin-plugins pidgin-musictracker\
 pidgin-guifications pidgin-plugin-pack;;
    "Kopete")urpmi --wget --auto kopete;;
    "Emesene")urpmi --wget --auto emesene;;
    "Kmess")urpmi --wget --auto kmess;;
    "Skype")urpmi --wget --auto skype;;
   esac;
  done;;
  
  "voip")
  #VoIP y videoconferencia
  shift 1
  for i in $@ ; do
   case $i in
    "Ekiga")urpmi --wget --auto ekiga;;
    "Gnokii")urpmi --wget --auto gnokii-xgnokii;;
    "Phone")urpmi --wget --auto gnome-phone-manager;;
   esac;
  done;;

 "p2p")
  #Cliente Bittorrent/p2p
  shift 1
  for i in $@ ; do
   case $i in
    "Vuze")urpmi --wget --auto vuze;;
    "Amule")urpmi --wget --auto amule;;
    "Apollon")urpmi --wget --auto apollon gift gift-gnutella gift-openft;;
    "Ktorrent")urpmi --wget --auto ktorrent;;
    "Deluge")urpmi --wget --auto deluge;;
    "Transmission")urpmi --wget --auto transmission transmission-gtk transmission-qt4;;
    "Nicotine")urpmi --wget --auto nicotine;;
    "Megaupload")urpmi --wget --auto megaupload-dl;;
    "Ed2k")urpmi --wget --auto ed2k-gtk-gui;;
   esac;
  done;;

 "burn")
  #Quemador
  shift 1
  for i in $@ ; do
   case $i in
    "K3b")urpmi --wget --auto k3b;;
    "Brasero")urpmi --wget --auto brasero;;
   esac;
  done;;

 "zip")
  #Compresores/Descompresores
  #Nota: normalmente varios de los paquetes vienen instalados de forma predeterminada
  #pero por si acaso pongo todos los que se pueden poner de la lista
  #proporcionada por el usuario Drakor en http://blogdrake.net/node/13532
  urpmi --wget --auto gzip bzip2 tar zip unzip unrar lha p7zip arj unarj zoo unace cabextract
  shift 1
  for i in $@ ; do
   case $i in
    "File-roller")urpmi --wget --auto file-roller;;
    "Ark")urpmi --wget --auto ark;;
   esac;
  done;;
  
  "devel")
  #Paquetes para el desarrollo de aplicaciones
  shift 1
  for i in $@ ; do
   case $i in
    "C")urpmi --wget --auto task-c-devel;;
    "C++")urpmi --wget --auto task-c++-devel;;
    "Fortran")urpmi --wget --auto gcc-gfortran;;
    "Basic")urpmi --wget --auto gambas2-ide gambas2-gb-gui;;
    "Rpm") urpmi --wget --auto rpmlint rpm-build spec-helper libtool;;
   esac;
   done;;
 
  "emu")
  #Emuladores y virtulizadores
  shift 1
  for i in $@ ; do
   case $i in
    "Wine")urpmi --wget --auto wine;;
    "Wine-doors")urpmi --wget --auto wine-doors;;
    "Playonlinux")urpmi --wget --auto playonlinux;;
    "VirtualBox")urpmi --wget --auto virtualbox;;
    "Qemu")urpmi --wget --auto qemu-launcher;;
    "M.A.M.E.")urpmi --wget --auto sdlmame sdlmame-extra-data;;
    "Rocksndiamonds")urpmi --wget --auto rocksndiamonds;;
   esac;
   done;;

  "Entornos")
  #Escritorios
  shift 1
  for i in $@ ; do
   case $i in
    "Kde4")urpmi --wget --auto task-kde4;;
    "Gnome")urpmi --wget --auto task-gnome;;
    "E17")urpmi --wget --auto task-e17;;
    "Moblin")urpmi --wget --auto task-moblin;;
    "Sugar")urpmi --wget --auto task-sugar;;
    "Ede")urpmi --wget --auto task-ede;;
    "Lxde")urpmi --wget --auto task-lxde;;
    "Xfce")urpmi --wget --auto task-xfce;;   
   esac;
   done;;

  "Misc")
  #Miscelanea
  shift 1
  for i in $@ ; do
   case $i in
    "Juegos")urpmi --wget --auto task-games;;
    "Procesadores de audio y video")urpmi --wget --auto task-sound-studio festival soundconverter audiokonverter konverter mixxx kttsd gaupol avidemux alsamixergui asunder dvdrip;;
    "Antivirus")urpmi --wget --auto clamav;;
    "Dock")urpmi --wget --auto cairo-dock;;
    "Imprescindibles")urpmi --wget --auto amor koffice-l10n-es koffice xscreensaver-matrix tmux kate task-blackberry-gnome task-3ddesktop-kde openoffice.org openoffice.org-help-es;;
   esac;
   done;;

 "kernel")
  #Kernel
  TIPO="`uname -r|cut -d '-' -f 2`"
  urpmi --wget --auto kernel-$TIPO-latest kernel-$TIPO-devel-latest kernel-headers;;

 "pulse")
  #Intentando que los usuarios no tengan problema con pulseaudio
  echo "pcm.!default {"> /etc/skel/.asoundrc
  echo "    type pulse">> /etc/skel/.asoundrc
  echo "}">> /etc/skel/.asoundrc
  echo "ctl.!default {">> /etc/skel/.asoundrc
  echo "    type pulse">> /etc/skel/.asoundrc
  echo "}">> /etc/skel/.asoundrc
  echo "pcm.pulse { type pulse }">> /etc/skel/.asoundrc
  echo "ctl.pulse { type pulse }">> /etc/skel/.asoundrc
  chmod a+rw /etc/skel/.asoundrc
  for i in /home/*; do
   cp -fp /etc/skel/.asoundrc $i/;
  done;;

 "tmp")
  #Limpiar /tmp al inicio
  if [ -z "`grep tmp /etc/rc.local`" ]; then
   echo "cd /tmp;rm -rf *" >> /etc/rc.local;
  fi;;
  *)echo "$0 no esta diseñado para ejecutarse directamente
por favor utilice alguna de las variantes de TuningDrake" >&2
 exit 1;;
esac
exit 0

